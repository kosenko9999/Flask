<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!--    <link rel="stylesheet" href="{{url_for('static',filename='css/main.css')}}">-->
    <title>Hello</title>
     <!--    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.0/FileSaver.min.js"></script>

      <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css" rel="stylesheet">
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/TableExport/5.2.0/css/tableexport.css" />
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/TableExport/5.2.0/css/tableexport.css" />

      <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.0.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-bootgrid/1.3.1/jquery.bootgrid.min.js" ></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/TableExport/5.2.0/js/tableexport.min.js" ></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-bootgrid/1.3.1/jquery.bootgrid.css"/>
      <script src="https://cdn.datatables.net/1.11.3/js/jquery.dataTables.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.11.2/umd/popper.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/datatables/1.10.19/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.1.0/js/dataTables.buttons.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
      <script src="https://cdn.datatables.net/buttons/2.1.0/js/buttons.html5.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.5/xlsx.min.js" ></script>


<!--	<script src="table-to-csv.min.js"></script>-->


    <!-- Bootstrap CSS -->

    <title>Hello, world!</title>
  </head>
  <body>
  <h1>Отчеты по выдачи и приему книг</h1>
<form method="post">
    <label for="start">Начало:</label>
    <input type="date" id="start" name="start"
       min="1900-01-01" max="2099-12-31" value=2022-01-01>
    <label for="start">Конец:</label>
    <input type="date" id="end" name="end"
       min="1900-01-01" max="2099-12-31" value=2022-01-15>
    <br>
    <input type="button" value="Сформировать отчеты" id="form_report">

    <br>
    <br>
    <label for="users">Сортировка:</label>
    <select name="sorting" id="sorting">
        <option value="False">Убыванию</option>
        <option value="True">Возрастанию</option>
    </select><br>
    <br>
    <label for="users">Столбец по которому сортируем:</label>


<div class="form-check">
  <input class="form-check-input" type="radio" name="column_table" value="id_user" id="flexRadioDefault1" >
  <label class="form-check-label" for="flexRadioDefault1">
    Пользователь
  </label>
</div>
<div class="form-check">
  <input class="form-check-input" type="radio" name="column_table" value="count_given_book" id="flexRadio2" checked>
  <label class="form-check-label" for="flexRadioDefault1">
    Количество выданных книг
  </label>
</div>
<div class="form-check">
  <input class="form-check-input" type="radio" name="column_table" id="flexRadio3" value="count_returned_book" >
  <label class="form-check-label" for="flexRadioDefault2">
    Количество вернувшихся книг
  </label>
</div>



</form>
<br>
<br>
<h1>Отчет</h1>
  <br>
<br>
<table id="books_given_and_returned" class="table table-condensed table-hover table-striped"  >
<thead><tr>
    <th data-column-id="id_user">Пользователь</th>
    <th data-column-id="count_given_book">Количество выданных книг</th>
    <th data-column-id="count_returned_book">Количество вернувшихся книг</th>
</tr>
</thead>
    <tbody>

</tbody>
</table>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js"></script>

  <script type=text/javascript>
var t = $('#books_given_and_returned').DataTable(
 {"ordering":false}
)

function getReport() {

}

$( document ).ready(function() {
console.log( "document loaded" );
$start_date = $('#start').val();
$end_date = $('#end').val();
$isascending = $('#sorting').val()
$filter_column = $('input[name="column_table"]:checked').val()


$.ajax({
    type: "GET",
    url: "/api/reports/users/returned?start_date="+$start_date+"&end_date="+$end_date+"&isascending="+$isascending+"&filter_column="+$filter_column,
    success: function(data){
     console.log("goooooo")
      $.each(data, function(i, data_log){
            console.log(i)
            t.row.add( [
            data_log.Name + " " +data_log.Surname,
            data_log.count_given_book,
            data_log.count_returned_book,
        ] ).draw(false);
       });
    }
    });

$("#start,#end,#sorting").on("change", function(){
t.clear().draw();
$start_date = $('#start').val();
$end_date = $('#end').val();
$isascending = $('#sorting').val()
$filter_column = $('input[name="column_table"]:checked').val()
$.ajax({
    type: "GET",
    url: "/api/reports/users/returned?start_date="+$start_date+"&end_date="+$end_date+"&isascending="+$isascending+"&filter_column="+$filter_column,
    success: function(data){
     console.log("goooooo")
      $.each(data, function(i, data_log){
            console.log(i)
            t.row.add( [
            data_log.Name + " " +data_log.Surname,
            data_log.count_given_book,
            data_log.count_returned_book,
        ] ).draw(false);
       });
    }
    });





});



});



</script>


  </body>
</html>


